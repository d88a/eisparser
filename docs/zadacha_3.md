1. Контекст экрана

Пользователь: user_id

Этап: stage = 1

Источник данных: ViewService.get_zakupka_stage_view(user_id, 1)

Экран ничего не вычисляет, он:

показывает,

принимает решения,

инициирует следующий этап.

2. Структура экрана (логическая)

Экран состоит из 4 зон:

┌──────────────────────────────────────────┐
│  A. Control Panel                        │
├──────────────────────────────────────────┤
│  B. Table: Zakupki (Stage 1)             │
├──────────────────────────────────────────┤
│  C. Detail / Preview (optional)          │
├──────────────────────────────────────────┤
│  D. Actions                              │
└──────────────────────────────────────────┘

3. A. Control Panel (верх экрана)

Цель: контекст и контроль.

Минимальный набор:

Пользователь: email / role

Этап: Stage 1 — Initial Intake

Счётчики:

Всего закупок

Approved

Rejected

Without decision

Пример логики:

Approved = count(decision == approved)

Pending = decision is null

❗ Важно:
никаких фильтров по умолчанию — сначала вся картина.

4. B. Основная таблица закупок (ключевая часть)
Одна строка = один ZakupkaStageView

Обязательные колонки:

Колонка	Смысл
reg_number	Якорь, идентификатор
description	Краткое описание
update_date	Актуальность
my_decision	Текущий статус
decision_comment	Комментарий
has_ai_result	❌ всегда False на Stage 1
listings_count	❌ всегда 0 на Stage 1

На Stage 1 не показываем:

AI-поля

listings

аналитику

Это сознательно. Stage 1 = входной контроль.

Интерактивность строки

На каждую строку:

Кнопки:

✅ Approve

❌ Reject

⏭ Skip (по умолчанию)

Поле:

Comment (optional, но желательно)

Правило:

решение сохраняется мгновенно

можно менять сколько угодно раз

сохраняется последнее

5. C. Detail / Preview (опционально, но рекомендую)

При клике на строку — панель предпросмотра:

Показывать:

combined_text (первые N строк)

ссылку на ЕИС (zakupka.link)

технические метаданные

Цель:

быстро понять, «что это вообще такое»

не уходить со страницы

Это резко повышает качество решений.

6. D. Actions (низ экрана)
Главная кнопка:
▶️ Run Stage 2 for Approved


Поведение:

Считает approved на Stage 1

Если approved == 0 → предупреждение

Запускает Stage 2 только для approved

Показывает:

сколько отправлено

статус выполнения

Важно:

кнопка не активна, если нет approved

запуск — осознанный акт

7. Что пользователь ДОЛЖЕН чувствовать на этом экране

«Я контролирую вход»

«Я понимаю, что отсекаю»

«Я не трачу ресурсы зря»

«Я вижу последствия своих решений»

Если этого нет — экран плохой.

8. Что на этом экране делать НЕЛЬЗЯ

❌ Показывать аналитику
❌ Делать автоматические решения
❌ Прятать rejected
❌ Автоматически запускать Stage 2

Stage 1 — это ручной шлюз.

9. Минимальный MVP (если делать очень быстро)

Если хочешь начать максимально просто:

Таблица

3 кнопки (Approve / Reject / Skip)

Кнопка «Run Stage 2»

Без preview

Даже так — архитектурно корректно.

10. Как это масштабируется дальше (чтобы ты видела путь)

Stage 2 экран:

появляется AI-интерпретация

появляются новые причины для reject

Stage 3:

проверка корректности GIS

Stage 4:

сравнение с рынком

Но логика экрана остаётся той же:

посмотреть → решить → пойти дальше