# Задание стажёру: Подготовка пользовательского дашборда и «админской подготовки» данных

## 1) Контекст проекта (коротко, чтобы было понятно без погружения)
Проект — EIS Parser: система для поиска закупок недвижимости на ЕИС, извлечения параметров через ИИ, генерации поисковых ссылок 2ГИС и сравнения цен с рыночными объявлениями. Пайплайн разделён на 4 стадии:

1. **Stage 1** — загрузка закупок из ЕИС и сохранение текста документов в БД.
2. **Stage 2** — ИИ‑извлечение параметров (город, площадь, комнаты, цена и т.д.) и сохранение результата.
3. **Stage 3** — генерация ссылки 2ГИС по параметрам.
4. **Stage 4** — сбор объявлений 2ГИС/ДомКлик/Циан для сравнения цен.

**Важно:** пользователь должен получать свежие объявления на момент анализа, поэтому **Stage 4 всегда запускается в пользовательском контуре**, даже если первые стадии подготовлены заранее администратором.

## 2) Цель задания
Сформировать основу дашборда и логики работы так, чтобы:
- **Администратор** заранее подготавливал закупки (Stage 1–3) и складывал в БД.
- **Пользователь** быстро выбирал закупки из БД и запускал **Stage 4** в момент анализа (для актуальных объявлений).

## 3) Твоя зона ответственности (что сделать)
Тебе нужно описать и частично реализовать UI‑логики (без жёсткой реализации всех компонентов), подготовить спецификацию API/статусов и предложить минимальный UI‑макет. Код можно менять в рамках frontend/templates + routes, но **не ломать существующий pipeline**.

### 3.1. Анализ текущего состояния
1. Ознакомься с:
   - `src/pipeline.py`
   - `src/api/routes.py`
   - шаблонами в `src/web/templates/`
2. Составь короткую карту «что уже есть» (1–2 страницы). Укажи:
   - Какие эндпоинты уже работают
   - Какие данные возвращают
   - Что нужно добавить

### 3.2. Описание пользовательского сценария (User flow)
Сформулируй цепочку шагов (flow), как пользователь будет работать в интерфейсе:
1. Открывает «Мои анализы» (или «Список закупок»)
2. Видит предварительно подготовленные закупки
3. Выбирает закупки
4. Смотрит результаты AI (Stage 2)
5. При необходимости правит параметры (overrides)
6. Запускает Stage 4 и получает свежие объявления

Требование: **Stage 4 не должен запускаться автоматически**. Он должен запускаться пользователем для актуальных данных.

### 3.3. Описание админского сценария (Admin flow)
Сформулируй цепочку шагов для администратора:
1. Запуск Stage 1–2 (и optionally Stage 3) по расписанию
2. Проверка статуса обработки
3. Подготовка «пула закупок», доступного пользователям

**Важно:** админ не принимает решения вместо пользователя (не approve/reject за него), а только готовит данные.

### 3.4. Предложение минимального набора API/статусов
Предложи схему данных (можно в виде псевдо-таблиц или JSON), например:

- `zakupki.status`: `raw | ai_ready | url_ready`
- `listings.status`: `fresh | stale | missing`
- или отдельный view `prepared_items`.

Опиши, какие эндпоинты нужны (минимум):
- `GET /api/available_zakupki` — список закупок, подготовленных админом
- `POST /api/user/select` — выбор закупок
- `POST /api/user/run_stage4` — запуск Stage 4
- `GET /api/user/listings` — результаты

### 3.5. Минимальный UI‑макет (можно текстом)
Сделай текстовый макет (wireframe):
- Экран «Список доступных закупок»
- Экран «Проверка AI / Overrides»
- Экран «Сравнение рынка»

Формат: список блоков, что отображается, какие кнопки.

### 3.6. Рекомендации по дальнейшей реализации (план работ)
Сформируй пошаговый план (5–7 шагов), что делать после твоей части:
- какие изменения в БД
- что добавить в API
- какие UI‑страницы делать первыми

## 4) Ограничения (обязательно соблюдать)
- **Нельзя** запускать Stage 4 автоматически без участия пользователя.
- **Нельзя** редактировать `AIResult` напрямую — использовать overrides.
- **Нельзя** смешивать данные разных пользователей.
- **Нельзя** превращать систему в автопайплайн без ручного gate.

## 5) Ожидаемый результат от тебя
Ты сдаёшь:
1. Текстовое описание user/admin flows.
2. Минимальный набор API/статусов.
3. Текстовые UI‑макеты.
4. План дальнейших шагов.

Объём: 2–4 страницы текста (можно в Markdown).

## 6) Критерии приёмки
- Понятно, как пользователь получит **быстрый доступ** к закупкам.
- Понятно, как обеспечить **актуальность объявлений**.
- Разделены роли: **админ — подготовка**, **пользователь — анализ**.
- Нет противоречий с базовой архитектурой (Stages + overrides).

